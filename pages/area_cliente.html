<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>√Årea do Cliente - DINA</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512" crossorigin="anonymous" />
    <style>
        .hidden { display: none; }
        .active-link { color: #2F9FF8; font-weight: bold; }
    </style>
</head>
<body class="bg-background text-text-primary flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-surface border-r border-border flex flex-col">
        <div class="p-6 flex items-center justify-center border-b border-border">
            <svg class="h-10 w-10" viewBox="0 0 32 32" fill="none">
                <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8b5cf6"/>
                        <stop offset="100%" style="stop-color:#06b6d4"/>
                    </linearGradient>
                </defs>
                <path d="M16 2L30 9v14L16 30 2 23V9L16 2z" fill="url(#logoGradient)"/>
                <path d="M16 8L24 12v8l-8 4-8-4v-8l8-4z" fill="#0a0a0a"/>
                <circle cx="16" cy="16" r="3" fill="url(#logoGradient)"/>
            </svg>
            <span class="ml-2 font-heading text-xl font-bold text-gradient">DINA</span>
        </div>
        <nav class="flex-1 p-4">
            <ul class="space-y-4">
                <li><a href="#" data-section="perfil" class="menu-link flex items-center space-x-3 text-primary hover:underline active-link"><i class="fa-solid fa-user"></i><span>Perfil</span></a></li>
                <li><a href="#" data-section="config" class="menu-link flex items-center space-x-3 hover:underline"><i class="fa-solid fa-cog"></i><span>Configura√ß√µes</span></a></li>
                <li><a href="#" data-section="dashboard" class="menu-link flex items-center space-x-3 hover:underline"><i class="fa-solid fa-chart-line"></i><span>Dashboard</span></a></li>
            </ul>
        </nav>
        <div class="p-4 border-t border-border">
            <button id="logout" class="w-full btn-secondary"><i class="fa-solid fa-right-from-bracket mr-2"></i>Sair</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
        <h1 class="text-3xl font-bold mb-6">Bem-vindo(a) √† sua √°rea da DINA üöÄ</h1>

        <!-- PERFIL -->
        <section id="perfil" class="conteudo-section">
            <div id="user-info" class="mb-10 p-6 bg-surface rounded-lg border border-border shadow">
                <p class="text-text-secondary">Carregando seus dados...</p>
            </div>
            <div class="p-6 bg-surface rounded-lg border border-border shadow">
                <h2 class="text-xl font-bold mb-4">A√ß√µes r√°pidas</h2>
                <div class="flex flex-wrap gap-4">
                    <button class="btn-primary"><i class="fa-solid fa-pen mr-2"></i>Editar Perfil</button>
                </div>
            </div>
        </section>

        <!-- CONFIGURA√á√ïES -->
        <section id="config" class="conteudo-section hidden">
            <div id="configuracoes-robo" class="p-6 bg-surface rounded-lg border border-border shadow mb-10">
                <h2 class="text-xl font-bold mb-6">‚öôÔ∏è Configura√ß√µes do Rob√¥</h2>
        
                <form id="config-form" class="space-y-8">
                    <!-- ================= INTERVALOS E EXECU√á√ÉO ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">‚è±Ô∏è Intervalos e Execu√ß√£o</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="timeframe-binance" class="block font-bold mb-2">Timeframe Binance</label>
                                <select id="timeframe-binance" name="TIMEFRAME_BINANCE" class="w-full p-2 border border-border rounded">
                                    <option value="1m">1m</option>
                                    <option value="5m" selected>5m</option>
                                    <option value="15m">15m</option>
                                    <option value="1h">1h</option>
                                </select>
                            </div>
                            <div>
                                <label for="intervalo-espera" class="block font-bold mb-2">Intervalo de Espera (segundos)</label>
                                <input type="number" id="intervalo-espera" name="INTERVALO_ESPERA" class="w-full p-2 border border-border rounded" value="300">
                            </div>
                        </div>
                    </div>
        
                    <!-- ================= PAR√ÇMETROS DE ORDEM ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">üí∞ Par√¢metros de Ordem</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="quantidade-padrao" class="block font-bold mb-2">Qtd. Padr√£o</label>
                                <input type="number" id="quantidade-padrao" name="QUANTIDADE_PADRAO" class="w-full p-2 border border-border rounded" value="1">
                            </div>
                            <div>
                                <label for="valor-minimo-operacao" class="block font-bold mb-2">Valor m√≠nimo por opera√ß√£o (USDT)</label>
                                <input type="number" id="valor-minimo-operacao" name="VALOR_MINIMO_OPERACAO" class="w-full p-2 border border-border rounded" value="10.10">
                            </div>
                            <div>
                                <label for="limiar-valor-usdt" class="block font-bold mb-2">Limiar valor USDT</label>
                                <input type="number" id="limiar-valor-usdt" name="LIMIAR_VALOR_USDT" class="w-full p-2 border border-border rounded" value="1.0">
                            </div>
                        </div>
                    </div>
        
                    <!-- ================= GRID DIN√ÇMICO ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">üìä Par√¢metros Grid Din√¢mico</h3>
                        <div>
                            <label class="block font-bold mb-2">PCTs Compra (%)</label>
                            <input type="text" id="grid-pcts-compra" name="GRID_PCTS_COMPRA" class="w-full p-2 border border-border rounded" value="-3,-6,-9">
                        </div>
                        <div class="mt-4">
                            <label class="block font-bold mb-2">PCTs Venda (%)</label>
                            <input type="text" id="grid-pcts-venda" name="GRID_PCTS_VENDA" class="w-full p-2 border border-border rounded" value="1.5,3,5">
                        </div>
                    </div>
        
                    <!-- ================= MACHINE LEARNING ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">üß† Par√¢metros de Machine Learning</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-bold mb-2">Ativos ML (auto ou lista)</label>
                                <input type="text" id="ativos-ml" name="ATIVOS_ML" class="w-full p-2 border border-border rounded" value="auto">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">Candles previs√£o</label>
                                <input type="number" id="n-candles" name="N_CANDLES_PREVISAO" class="w-full p-2 border border-border rounded" value="15">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">Window Size</label>
                                <input type="number" id="window-size" name="WINDOW_SIZE" class="w-full p-2 border border-border rounded" value="20">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block font-bold mb-2">Timeframes ML</label>
                            <input type="text" id="timeframes-ml" name="TIMEFRAMES_ML" class="w-full p-2 border border-border rounded" value="15m,1h,1d">
                        </div>
                    </div>
        
                    <!-- ================= PAR√ÇMETROS DE TRADE ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">ü§ñ Par√¢metros de Trade</h3>
                        <div>
                            <label class="block font-bold mb-2">Ativos interesse (auto ou lista)</label>
                            <input type="text" id="ativos-interesse" name="ATIVOS_INTERESSE" class="w-full p-2 border border-border rounded" value="auto">
                        </div>
                        <div class="mt-4">
                            <label class="block font-bold mb-2">Timeframes interesse</label>
                            <input type="text" id="timeframes-interesse" name="TIMEFRAMES_INTERESSE" class="w-full p-2 border border-border rounded" value="15m">
                        </div>
                    </div>
        
                    <!-- ================= RISCO E ESTRAT√âGIAS ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">üîí Risco e Estrat√©gias</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-bold mb-2">Stop Loss (%)</label>
                                <input type="number" id="stop-loss" name="STOP_LOSS_PCT" class="w-full p-2 border border-border rounded" value="-5">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">Take Profit (%)</label>
                                <input type="number" id="take-profit" name="TAKE_PROFIT_PCT" class="w-full p-2 border border-border rounded" value="1.5">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">Trailing Stop (%)</label>
                                <input type="number" id="trailing-stop" name="TRAILING_STOP_PERCENTUAL" class="w-full p-2 border border-border rounded" value="3">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block font-bold mb-2">Estrat√©gias selecionadas</label>
                            <input type="text" id="estrategias-selecionadas" name="ESTRATEGIAS_SELECIONADAS" class="w-full p-2 border border-border rounded" value="final_unificada">
                        </div>
                    </div>
        
                    <!-- ================= CAPITAL E LIMITES ================= -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">üíº Gest√£o de Capital</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-bold mb-2">Valor padr√£o aloca√ß√£o (%)</label>
                                <input type="number" id="valor-padrao-alocacao" name="VALOR_PADRAO_ALOCACAO" class="w-full p-2 border border-border rounded" value="5">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">Aloca√ß√£o M√°xima (%)</label>
                                <input type="number" id="pct-max-alocacao" name="PCT_MAX_ALOCACAO" class="w-full p-2 border border-border rounded" value="20">
                            </div>
                            <div>
                                <label class="block font-bold mb-2">M√≠nimo por opera√ß√£o (USDT)</label>
                                <input type="number" id="min-valor-operacao" name="MIN_VALOR_OPERACAO" class="w-full p-2 border border-border rounded" value="5.0">
                            </div>
                        </div>
                    </div>
        
                    <!-- ================= BOT√ïES ================= -->
                    <div class="flex gap-4 mt-8">
                        <button type="button" id="start-bot" class="btn-primary flex-1"><i class="fa-solid fa-play mr-2"></i>Iniciar Rob√¥</button>
                        <button type="button" id="stop-bot" class="btn-secondary flex-1"><i class="fa-solid fa-stop mr-2"></i>Parar Rob√¥</button>
                        <button type="submit" class="btn-primary flex-1"><i class="fa-solid fa-save mr-2"></i>Salvar Configura√ß√µes</button>
                    </div>
                </form>
            </div>
        </section>


        <!-- DASHBOARD -->
        <section id="dashboard" class="conteudo-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="p-6 bg-surface rounded-lg border border-border shadow">
                    <h2 class="font-bold mb-2">Progresso</h2>
                    <p class="text-text-secondary">Acompanhe seu avan√ßo na plataforma</p>
                </div>
                <div class="p-6 bg-surface rounded-lg border border-border shadow">
                    <h2 class="font-bold mb-2">Metas</h2>
                    <p class="text-text-secondary">Defina seus objetivos e acompanhe</p>
                </div>
                <div class="p-6 bg-surface rounded-lg border border-border shadow">
                    <h2 class="font-bold mb-2">Notifica√ß√µes</h2>
                    <p class="text-text-secondary">Fique por dentro das novidades</p>
                </div>
            </div>
            <div class="p-6 bg-surface rounded-lg border border-border shadow">
                <h2 class="text-xl font-bold mb-4">A√ß√µes r√°pidas</h2>
                <div class="flex flex-wrap gap-4">
                    <button class="btn-primary"><i class="fa-solid fa-plus mr-2"></i>Nova Meta</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // ================= TOKEN =================
        const urlParams = new URLSearchParams(window.location.search);
        const tokenFromURL = urlParams.get('token');
        if (tokenFromURL) {
            localStorage.setItem('token', tokenFromURL);
            const cleanUrl = window.location.origin + window.location.pathname;
            window.history.replaceState({}, document.title, cleanUrl);
        }
        const token = localStorage.getItem('token');
        if (!token) window.location.href = 'login.html';

        // ================= USU√ÅRIO =================
        fetch('https://dina-backend-5uop.onrender.com/me', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(response => {
            if (!response.ok) throw new Error('Token inv√°lido');
            return response.json();
        })
        .then(user => {
            document.getElementById('user-info').innerHTML = `
                <h2 class="text-xl font-bold mb-4">Seus Dados</h2>
                <p><strong>Nome:</strong> ${user.nome}</p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Experi√™ncia:</strong> ${user.experiencia || '‚Äî'}</p>
                <p><strong>Objetivo:</strong> ${user.objetivo || '‚Äî'}</p>
            `;
        })
        .catch(() => {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        });

        // ================= LOGOUT =================
        document.getElementById('logout').addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        });

        // ================= MENU TOGGLE =================
        const links = document.querySelectorAll('.menu-link');
        const sections = document.querySelectorAll('.conteudo-section');

        links.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = link.dataset.section;

                // Trocar active
                links.forEach(l => l.classList.remove('active-link'));
                link.classList.add('active-link');

                // Mostrar se√ß√£o
                sections.forEach(sec => {
                    sec.id === target ? sec.classList.remove('hidden') : sec.classList.add('hidden');
                });
            });
        });

        // ================= BOT√ïES ROB√î =================
        document.getElementById('start-bot').addEventListener('click', () => {
            alert('Rob√¥ iniciado com as configura√ß√µes definidas!');
        });
        document.getElementById('stop-bot').addEventListener('click', () => {
            alert('Rob√¥ parado com sucesso!');
        });
    </script>
</body>
</html>
